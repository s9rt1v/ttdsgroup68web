{% extends 'recommend/base.html'%}

{% block body %}

{% if not request.user.is_authenticated %}
    <br>
{% else %}
    <center style="color:#fff"><h2>Welcome {{user.username}} !</h2></center>
{% endif %}

<div class="container" >
    <div class="col-xs-6 col-xs-offset-3">
    	<form class="form-horizontal" role="search" method="get" action="{% url 'list' %}">
            <div class="form-group">
                <div class="input-group">
                    <span>use deep learning search
                        <input type="checkbox" value="deeplearning" name="watch">
                    </span>
                    <input type="text" class="form-control input-lg " id="search-input" name="q" value="{{ request.GET.q }}" placeholder= "Search Movies "/>

                    <div class="dropdown">
                            <ul id="suggestions" class="dropdown-menu"></ul>
                    </div>
                    <span class='input-group-btn'>
                        <button class='button1' type='submit'>Search</button>
                    </span>
                </div>

            </div>
        </form>
    </div>
 </div>

    <p style="text-align:left;">
    <h3>Latest Release</h3>
    </span>
</p>

<br>
<div class="container">
        <!-- 轮播图 -->
        <div id="carousel-example-generic" class="carousel slide carousel-fade" data-ride="carousel"  data-bs-wrap="true">
            <!-- Indicators 小圆点-->
            <ol class="carousel-indicators">
                <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                <li data-target="#carousel-example-generic" data-slide-to="2"></li>
                <li data-target="#carousel-example-generic" data-slide-to="3" ></li>
                <li data-target="#carousel-example-generic" data-slide-to="4"></li>
                <li data-target="#carousel-example-generic" data-slide-to="5"></li>
                <li data-target="#carousel-example-generic" data-slide-to="6"></li>
                <li data-target="#carousel-example-generic" data-slide-to="7"></li>
                <li data-target="#carousel-example-generic" data-slide-to="8" ></li>
                <li data-target="#carousel-example-generic" data-slide-to="9"></li>
            </ol>
            <!-- Wrapper for slides 轮播图--->
              <!-- Wrapper for slides 轮播图-->

            <div class="carousel-inner" role="listbox">
                <div class="item active">
                    <a href="{% url 'detail' ids.0 %}">
                    <img src="{{urls.0}}" alt="a1" id="first-slide">
                        </a>
                    <div class="carousel-caption">
                        {{ titles.0 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.1 %}">
                    <img src="{{urls.1}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.1 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.2 %}">
                    <img src="{{urls.2}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.2 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.3 %}">
                    <img src="{{urls.3}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.3 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.4 %}">
                    <img src="{{urls.4}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.4 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.5 %}">
                    <img src="{{urls.5}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.5 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.6 %}">
                    <img src="{{urls.6}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.6 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.7 %}">
                    <img src="{{urls.7}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.7 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.8 %}">
                    <img src="{{urls.8}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.8 }}
                    </div>
                </div>
                <div class="item">
                    <a href="{% url 'detail' ids.9 %}">
                    <img src="{{urls.9}}" alt="a1">
                        </a>
                    <div class="carousel-caption">
                         {{ titles.9 }}
                    </div>
                </div>
            </div>
            <!-- Controls 左右翻页-->
            <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>

        </div>
    </div>
<br>
    <br>
    <p style="text-align:left;">
    <h3>Advanced Filter</h3>
    </span>
</p>

<div class="container" >
<div class="p-3 mb-1">
<div class="row no-gutters flex-nowrap mb-1">
<span class="" style="min-width: 3.0em;">Genre：</span>
<div class="col">
  <li class="cat-li All genre">All</li>
  <li class="cat-li Fantasy genre">Fantasy</li>
  <li class="cat-li Action genre">Action</li>
  <li class="cat-li Thriller genre">Thriller</li>
  <li class="cat-li Mystery genre">Mystery</li>
  <li class="cat-li Drama genre">Drama</li>
  <li class="cat-li Comedy genre">Comedy</li>
  <li class="cat-li Horror genre">Horror</li>
  <li class="cat-li Romance genre">Romance</li>
  <li class="cat-li Documentary genre">Documentary</li>
  <li class="cat-li Animation genre">Animation</li>
  <li class="cat-li Crime genre">Crime</li>
  <li class="cat-li War genre">War</li>
  <li class="cat-li History genre">History</li>
</div>
</div>
    <div class="row no-gutters flex-nowrap mb-1">
<span class="" style="min-width: 3.0em;">Year：</span>
<div class="col">
  <li class="cat-li year yAll">All</li>
  <li class="cat-li year y2023">2023</li>
  <li class="cat-li year y2022">2022</li>
  <li class="cat-li year y2021">2021</li>
  <li class="cat-li year y2020">2020</li>
  <li class="cat-li year y2010-2019">2010-2019</li>
  <li class="cat-li year y2000-2009">2000-2009</li>
  <li class="cat-li year yEarlier">Earlier</li>
</div>
</div>
</div>
</div>


    <br>
    <br>

    <!-- Movie list -->
<div class="row">
    {% if movies %}
    {% for movie in movies %}
        <div class="col-sm-2 col-md-2 ">
            <div class="thumbnail">
                <h4>{{movie.title}}</h4>
                <a href="{% url 'detail' movie.id %}">
                    <img src="{{ movie.poster_path}}" class="img-responsive" style="border-radius: 22px 22px 22px 22px; width: 200px; height: 250px; object-fit: cover;">
                </a>
                <h5>{{movie.genre}}</h5>
            </div>
        </div>
    {% endfor %}
    {% else %}
        <div class="alert alert-danger">
            <strong>Sorry!</strong> No movies in your list.
        </div>
    {% endif %}

</div>

    <script>
     const searchInput = document.getElementById('search-input');
     const suggestions = document.getElementById('suggestions');

window.onload = function() {
  // 添加输入事件监听器
  searchInput.addEventListener('input', function() {
    const searchTerm = searchInput.value.trim().toLowerCase();
    if (searchTerm.length > 0) {
      const xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
          const response = this.responseText;
          const suggestionsList = JSON.parse(response); // 解析JSON格式的response
          let output = '';
          let count = 0;
          suggestionsList.forEach(function(suggestion) {
            if (count < 10 && suggestion.toLowerCase().startsWith(searchTerm)) {
              output += '<li><a href="#">' + suggestion + '</a></li>';
              count++;
            }
          });
          suggestions.innerHTML = output;

          // 为下拉菜单项添加点击事件监听器
          const dropdownItems = suggestions.querySelectorAll('li');
          dropdownItems.forEach(function(item) {
            item.addEventListener('click', function() {
              searchInput.value = item.textContent;
              suggestions.innerHTML = '';
            });
          });
        } else if (this.readyState === 4 && this.status !== 200) {
          suggestions.innerHTML = '请求失败，请检查文本文件路径是否正确';
        }
      };
      xhr.open('GET', '/static/txt/title.txt', true);
      xhr.send();
    } else {
      suggestions.innerHTML = '';
    }
  });
};

	</script>
{% endblock %}
